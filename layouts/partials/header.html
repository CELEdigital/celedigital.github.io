<header class="site-header">
  <div class="header-container header-inner">
    <a class="site-logo" href="/">
      {{ with .Site.Params.logo }}
        <img src="{{ . | relURL }}" alt="{{ $.Site.Title }}">
      {{ else }}
        {{ .Site.Title }}
      {{ end }}
    </a>

    <nav class="main-nav" aria-label="Navegación principal">
      <ul class="main-nav-list">
        {{ range .Site.Menus.main }}
          {{ $isAcerca := or (eq .Identifier "acerca-de") (eq .Name "Acerca de") (eq .URL "/acerca-de/") }}
          {{ if $isAcerca }}
            <li class="nav-item nav-item--dropdown">
              <button class="nav-link nav-button" type="button" data-nav-toggle aria-expanded="false" aria-controls="nav-acerca">
                {{ .Name }}
              </button>
              <div class="nav-dropdown" id="nav-acerca" data-nav-menu hidden>
                {{ if .Children }}
                  {{ range .Children }}
                    <a class="nav-dropdown-link" href="{{ .URL | relLangURL }}">{{ .Name }}</a>
                  {{ end }}
                {{ else }}
                  <span class="nav-dropdown-empty">Agrega opciones en el menú.</span>
                {{ end }}
              </div>
            </li>
          {{ else }}
            <li class="nav-item">
              <a class="nav-link" href="{{ .URL | relLangURL }}">{{ .Name }}</a>
            </li>
          {{ end }}
        {{ end }}
        <li class="nav-item nav-item--lang">
          <div class="lang-toggle" role="group" aria-label="{{ i18n "language_toggle" }}">
            {{ $current := . }}
            {{ $translations := .Translations }}
            {{ $tkey := $current.Params.translationKey }}
            {{ range .Sites }}
              {{ $target := .Home }}
              {{ if $current.IsTranslated }}
                {{ $matches := where $translations "Lang" .Language.Lang }}
                {{ if gt (len $matches) 0 }}
                  {{ $target = index $matches 0 }}
                {{ end }}
              {{ end }}
              {{ if and (not $current.IsTranslated) $tkey }}
                {{ $candidates := where .AllPages "Params.translationKey" $tkey }}
                {{ $langMatches := where $candidates "Lang" .Language.Lang }}
                {{ if gt (len $langMatches) 0 }}
                  {{ $target = index $langMatches 0 }}
                {{ end }}
              {{ end }}
              {{ if eq .Language.Lang $current.Language.Lang }}
                <span class="lang-toggle-item lang-toggle-item--active">{{ upper .Language.Lang }}</span>
              {{ else }}
                <a class="lang-toggle-item" href="{{ $target.RelPermalink }}">{{ upper .Language.Lang }}</a>
              {{ end }}
            {{ end }}
          </div>
        </li>
      </ul>
    </nav>
  </div>
</header>

<script>
  (() => {
    const toggle = document.querySelector('[data-nav-toggle]');
    const menu = document.querySelector('[data-nav-menu]');
    if (!toggle || !menu) return;

    const closeMenu = () => {
      menu.hidden = true;
      toggle.setAttribute('aria-expanded', 'false');
    };

    const openMenu = () => {
      menu.hidden = false;
      toggle.setAttribute('aria-expanded', 'true');
    };

    toggle.addEventListener('click', () => {
      const isOpen = toggle.getAttribute('aria-expanded') === 'true';
      if (isOpen) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    document.addEventListener('click', (event) => {
      if (!menu.contains(event.target) && !toggle.contains(event.target)) {
        closeMenu();
      }
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        closeMenu();
      }
    });
  })();
</script>
